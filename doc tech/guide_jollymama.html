<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Documentation Technique - Gestion Pros Jollymama</title>
    <style>
        :root {
            --primary: #008060; /* Vert Shopify */
            --secondary: #005bd3; /* Bleu Admin */
            --danger: #d82c0d;
            --light: #f6f6f7;
            --border: #e1e3e5;
            --text: #202223;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--text);
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px;
            background: white;
        }
        /* Header */
        header {
            border-bottom: 2px solid var(--border);
            padding-bottom: 20px;
            margin-bottom: 40px;
        }
        h1 { margin: 0; color: var(--text); font-size: 28px; }
        .subtitle { color: #6d7175; font-size: 16px; margin-top: 5px; }
        .tag {
            background: #e3f1df; color: var(--primary); 
            padding: 2px 8px; border-radius: 4px; 
            font-size: 12px; font-weight: bold; text-transform: uppercase;
            border: 1px solid #b7eb8f;
        }

        /* Sections */
        /* MODIFICATION ICI : On autorise la coupure des sections */
        section { margin-bottom: 40px; }
        
        h2 { 
            color: var(--secondary); 
            font-size: 20px; 
            border-left: 4px solid var(--secondary); 
            padding-left: 10px; margin-bottom: 15px; 
            /* On √©vite juste qu'un titre se retrouve tout seul en bas de page */
            page-break-after: avoid; 
        }
        h3 { font-size: 16px; font-weight: 700; margin-top: 20px; color: #444; }

        /* Listes & Logique */
        ul { padding-left: 20px; }
        li { margin-bottom: 8px; }
        
        .logic-step {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            /* On garde l'interdiction de coupure uniquement pour les petits blocs gris */
            page-break-inside: avoid; 
        }
        .logic-step strong { color: var(--primary); }

        /* Badges techniques */
        code {
            background: #f0f0f0;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
            color: #d63384;
            font-size: 0.9em;
        }
        .badge-pro { background: #e4e5e7; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-family: monospace; }

        /* Footer */
        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 12px;
            color: #8c9196;
        }

        @media print {
            body { padding: 0; max-width: 100%; }
            /* Optimisation saut de page */
            h2 { margin-top: 30px; }
        }
    </style>
</head>
<body>

<header>
    <h1>üìò Documentation Technique & Fonctionnelle</h1>
    <div class="subtitle">Application : <strong>App MM - Gestion Pros - JM</strong></div>
    <div style="margin-top:10px;">
        <span class="tag">Version 2.0</span>
        <span class="tag" style="color:#005bd3; background:#f0f8ff; border-color:#b8d0eb;">Production</span>
        <span class="tag" style="color:#5c5f62; background:#f6f6f7; border-color:#d2d5d8;">H√©bergement : Render</span>
    </div>
</header>

<section>
    <h2>1. Infrastructure & Concept Global</h2>
    <p>L'application est une <strong>Shopify App Custom</strong> h√©berg√©e sur des serveurs externes (Render). Elle agit comme un "chef d'orchestre" entre l'administrateur Jollymama et les API Shopify (Clients, R√©ductions, Commandes).</p>
    <div class="logic-step">
        <strong>Objectif :</strong> Automatiser la gestion des pro et leur r√©mun√©ration via un syst√®me de "Store Credit" natif.
    </div>
</section>

<section>
    <h2>2. Cycle de Vie des Donn√©es (Logique Automatis√©e)</h2>
    <p>Voici le comportement exact du syst√®me pour chaque action effectu√©e dans le Back-office.</p>

    <h3>üîπ A. Initialisation (Installation)</h3>
    <ul>
        <li>L'application scanne la boutique pour voir si la structure existe.</li>
        <li>Si absente, elle cr√©e la d√©finition de <code>M√©taobjet</code> avec tous les champs requis (Ref, Nom, Email, Code, Montant, Compteurs CA...).</li>
    </ul>

    <h3>üîπ B. Cr√©ation d'un Partenaire (Onglet Gestion Pros)</h3>
    <div class="logic-step">
        Lorsqu'on clique sur "Ajouter" :
        <ol>
            <li><strong>Base de donn√©es :</strong> Cr√©ation de l'entr√©e dans l'app.</li>
            <li><strong>Code Promo :</strong> Appel API pour cr√©er le code de r√©duction (ex: <code>HENRIK5</code>) dans Shopify.</li>
            <li><strong>Liaison Client (Smart Sync) :</strong>
                <ul>
                    <li>L'app cherche si l'email existe d√©j√† dans Shopify.</li>
                    <li><em>Si OUI :</em> Elle ajoute le tag <span class="badge-pro">pro_sante</span> et met √† jour le nom (Format : "Pr√©nom NOM").</li>
                    <li><em>Si NON :</em> Elle cr√©e un nouveau client et ajoute le tag <span class="badge-pro">pro_sante</span>.</li>
                </ul>
            </li>
            <li><strong>Finalisation :</strong> L'ID unique du client Shopify est stock√© dans l'app pour maintenir le lien √† vie.</li>
        </ol>
    </div>

    <h3>üîπ C. Modification d'un Partenaire</h3>
    <ul>
        <li><strong>Donn√©es :</strong> Mise √† jour des champs dans le M√©taobjet.</li>
        <li><strong>Code Promo :</strong> Si le code ou le montant change (ex: 5% ‚Üí 10%), la r√©duction Shopify est mise √† jour instantan√©ment.</li>
        <li><strong>Client :</strong> Si l'email ou le nom change, la fiche client Shopify est automatiquement corrig√©e.</li>
    </ul>

    <h3>üîπ D. Suppression d'un Partenaire</h3>
    <div class="logic-step" style="border-left: 4px solid var(--danger);">
        <strong>Action de nettoyage stricte :</strong>
        <ul>
            <li>Suppression du <strong>Code Promo</strong> dans Shopify (il ne fonctionne plus).</li>
            <li>Suppression de l'entr√©e dans l'application.</li>
            <li><strong>Nettoyage Client :</strong> L'app retire le tag <span class="badge-pro">pro_sante</span> du client Shopify.</li>
            <li><em>Note :</em> Le client n'est PAS supprim√© (pour conserver l'historique des commandes), il redevient un client classique.</li>
        </ul>
    </div>

    <h3>üîπ E. Activation / D√©sactivation</h3>
    <ul>
        <li>Modifie le statut du Code Promo dans Shopify (Actif / Expir√©).</li>
        <li>Le partenaire reste visible dans l'app, mais son code ne fonctionne plus au checkout.</li>
    </ul>

    <h3>üîπ F. Suppression Totale (Zone Danger)</h3>
    <ul>
        <li>Supprime la structure du M√©taobjet.</li>
        <li>Avant de supprimer, l'app boucle sur toutes les entr√©es pour nettoyer les codes promos et les tags clients associ√©s.</li>
    </ul>
</section>

<section>
    <h2>3. Syst√®me de R√©mun√©ration Automatique</h2>
    <p>Le "Cerveau financier" de l'application fonctionne via des <strong>Webhooks</strong> (√©couteurs d'√©v√©nements) en temps r√©el.</p>

    <div class="logic-step">
        <strong>üí∞ La R√®gle Math√©matique :</strong><br>
        10,00 ‚Ç¨ de Cr√©dit Boutique offerts tous les 500,00 ‚Ç¨ de CA g√©n√©r√©.
    </div>

    <h3>Le Processus (Invisible et Automatique) :</h3>
    <ol>
        <li>Un client passe une commande sur le site.</li>
        <li>L'app d√©tecte l'utilisation d'un <strong>Code Promo Pro</strong>.</li>
        <li>Elle calcule le nouveau <strong>CA Total cumul√©</strong> du partenaire.</li>
        <li>Elle v√©rifie si un nouveau palier de 500‚Ç¨ est franchi.</li>
        <li><strong>Action Bancaire :</strong> Si un gain est d√©tect√© (ex: +10‚Ç¨), l'app effectue un virement API direct sur le compte <code>Store Credit</code> du client.</li>
    </ol>
</section>

<section>
    <h2>4. Guide des Interfaces</h2>

    <h3>üè• Onglet 1 : Gestion Pros de Sant√©</h3>
    <p>Interface principale CRUD (Create, Read, Update, Delete).</p>
    <ul>
        <li>Permet de g√©rer la base de donn√©es.</li>
        <li>Assure la synchronisation des emails et noms.</li>
    </ul>

    <h3>üè∑Ô∏è Onglet 2 : Gestion Codes Promo</h3>
    <p>Vue simplifi√©e ax√©e sur les r√©ductions.</p>
    <ul>
        <li>Voir la liste des codes techniques.</li>
        <li>Activer/D√©sactiver un code en un clic.</li>
    </ul>

    <h3>üë• Onglet 3 : Gestion Clients Pros (Reporting)</h3>
    <p>Tableau de bord de performance (Lecture Seule).</p>
    <ul>
        <li>Affiche uniquement les clients ayant le tag <span class="badge-pro">pro_sante</span>.</li>
        <li><strong>Colonnes Calcul√©es :</strong>
            <ul>
                <li><em>Commandes :</em> Nombre d'utilisations.</li>
                <li><em>CA G√©n√©r√© :</em> Chiffre d'affaires total apport√©.</li>
                <li><em>Gagn√© / Utilis√© / Restant :</em> √âtat du cr√©dit boutique en temps r√©el.</li>
            </ul>
        </li>
    </ul>
</section>

<footer>
    Document g√©n√©r√© le 03/01/2026<br>
    D√©veloppement & Maintenance : <strong>Moon Moon</strong>
</footer>

</body>
</html>